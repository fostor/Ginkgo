(function(){$(function(){function t(){r.getByTaskCode(u).done(function(n){s(n)})}function s(n){var t=[{data:"phaseCode",width:"80px"},{data:"phaseName",width:"80px"},{orderable:!1,bSortable:!1,data:"id",width:"35px",render:function(n){var t='<div style="text-align:center;" >';return t+='   <a href="#" class="waves-effect waves-block edit-task-phase" data-item-id="'+n+'" data-toggle="modal" data-target="#TaskPhaseEditModal"><i class="tiny material-icons">reorder<\/i><\/a>',t+"<\/div>"}},{orderable:!1,bSortable:!1,data:"id",width:"35px",render:function(n,t,i){var r='<div style="text-align:center;" >';return r+='   <a href="#" class="waves-effect waves-block delete-task-phase" data-item-id="'+n+'" data-code="'+i.phaseCode+'" ><i class="tiny material-icons">delete<\/i><\/a>',r+"<\/div>"}},{data:"taskRole",width:"100px"},{data:"taskUsers",width:"100px"},{data:"isCountersignPhase",width:"100px",render:function(n){var t="";return n&&(t="Y"),t}},{data:"isSignInPhase",width:"100px",render:function(n){var t="";return n&&(t="Y"),t}},{data:"canUpdateForm",width:"100px",render:function(n){var t="";return n&&(t="Y"),t}},{data:"updateFormUriTemplate",width:"150px"},{data:"canBatchHandle",width:"100px",render:function(n){var t="";return n&&(t="Y"),t}},{data:"batchHandleUriTemplate",width:"150px"},{data:"canReject",width:"100px",render:function(n){var t="";return n&&(t="Y"),t}},{data:"condition1EndValue",width:"100px"},{data:"condition2EndValue",width:"100px"},{data:"condition3EndValue",width:"100px"},{data:"lastModifier",width:"50px"},{data:"lastModificationTime",width:"80px"},{data:"creator",width:"50px"},{data:"creationTime"}];f=$("#table_100").DataTable({data:n,destroy:!0,searching:!0,dom:"Bftir",language:$.getDataTableLang(),buttons:$.getDataTableButtons(),deferRender:!0,scrollY:i,scrollX:!0,scrollCollapse:!0,scroller:!0,columns:t,initComplete:function(){h();c();$.setTableSelectedRowsCss("table_100");$.fixDataTableHeight("table_100",i)}})}function h(){$(".edit-task-phase").click(function(n){n.preventDefault();var t=$(this).attr("data-item-id");$.ajax({url:abp.appPath+"TaskFlow/Flow/EditPhaseModal?id="+t,type:"POST",contentType:"application/html",success:function(n){$("#TaskPhaseEditModal div.modal-content").html(n)},error:function(){}})})}function c(){$(".delete-task-phase").click(function(n){n.preventDefault();var i=$(this).attr("data-item-id"),u=$(this).attr("data-code");abp.message.confirm(abp.utils.formatString(abp.localization.localize("DeleteTaskPhase{0}?","Ginkgo"),u),function(n){n&&r.delete({id:i}).done(function(){t()})})})}function l(){if(n.valid()){$.setCheckVal(n);var t=n.serializeFormToObject();abp.ui.setBusy(n);o.update(t).done(function(){e()}).always(function(){abp.ui.clearBusy(n)})}}function e(){if(history.length>1){var t=location.href,n=1;t.indexOf("#")>0&&(n+=1);t.indexOf("fromadd")>0&&(n+=1);history.go(-n)}else window.close()}var o=abp.services.app.taskTemplate,r=abp.services.app.taskPhase,n=$("form[name=FlowEditForm]"),u=n.find("input[name=TaskCode]").val(),f,i;$(".add-task-phase").click(function(n){n.preventDefault();$.ajax({url:abp.appPath+"TaskFlow/Flow/AddPhaseModal?taskCode="+u,type:"POST",contentType:"application/html",success:function(n){$("#TaskPhaseCreateModal div.modal-content").html(n)},error:function(){}})});f=null;i=Math.max($(window).height()-465,100);t();$("#TaskPhaseCreateModal").on("hide.bs.modal",function(){var n=$(this).find(".save-button").hasClass("save-clicked");n&&t()});$("#TaskPhaseEditModal").on("hide.bs.modal",function(){var n=$(this).find(".save-button").hasClass("save-clicked");n&&t()});$(".edit-save-button").click(function(n){n.preventDefault();l()});$(".edit-close-button").click(function(){e()});$.AdminBSB.input.activate(n)})})();