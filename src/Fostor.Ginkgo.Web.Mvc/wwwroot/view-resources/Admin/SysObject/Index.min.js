(function(){$(function(){function i(n){$.ajax({url:abp.appPath+"Admin/SysObject/Edit?id="+n,type:"POST",contentType:"application/html",success:function(n){$("#edit_panel").html(n);$.AdminBSB.input.activate($("#edit_panel").find("form[name=SysObjectEditForm]"))},error:function(){}})}function r(){t.getTree().done(function(n){if(n){var t=JSON.stringify(n);t=t.replace(/,"nodes":\[\]/g,"");$("#tree").treeview({data:t,showBorder:!1,color:"#00BCD4",levels:2,selectedBackColor:"#d9edf7",selectedColor:"#3c85a9",onNodeSelected:function(n,t){i(t.id)}})}})}function u(){var n=$("#edit_panel").find("form[name=SysObjectEditForm]"),i,e,r,u;if(n.valid()){if($.setCheckVal(n),i=n.serializeFormToObject(),e=n.find("input[name=ObjectKey]").val(),i.RefPermissions=[],r=$("input[name='permission0']:checked"),r)for(u=0;u<r.length;u++){var o=$(r[u]),s=o.attr("data-permission-name"),h=o.attr("data-display-name"),f={};f.ObjectKey=e;f.PermissionName=s;f.DisplayName=h;i.RefPermissions.push(f)}abp.ui.setBusy(n);t.update(i).done(function(){$.showOK("保存成功")}).always(function(){abp.ui.clearBusy(n)})}}var t=abp.services.app.sysObject,n;$("#tree_container").height($(window).height()-220);$("#edit_panel").height($("#tree_container").height()-50);n=$("#tree_container").attr("data-tree");n=n.replace(/,"nodes":\[\]/g,"");$("#tree").treeview({data:n,showBorder:!1,color:"#00BCD4",levels:2,selectedBackColor:"#d9edf7",selectedColor:"#3c85a9",onNodeSelected:function(n,t){i(t.id)}});$(".delete-object").on("click",function(n){n.preventDefault();var i=$("#edit_panel").find("input[name=Id]").val(),u=$("#edit_panel").find("input[name=ObjectKey]").val();abp.message.confirm($.deleteConfirm(u),function(n){n&&t.delete({id:i}).done(function(){r();$("#edit_panel").html("")})})});$(".add-root-node").click(function(n){n.preventDefault();$.ajax({url:abp.appPath+"Admin/SysObject/Add",type:"POST",contentType:"application/html",success:function(n){$("#SysObjectCreateModal div.modal-content").html(n)},error:function(){}})});$(".add-sub-node").click(function(n){n.preventDefault();var t=$("#edit_panel").find("input[name=ObjectKey]").val();t?$.ajax({url:abp.appPath+"Admin/SysObject/Add?parentKey="+t,type:"POST",contentType:"application/html",success:function(n){$("#SysObjectCreateModal div.modal-content").html(n);$("#SysObjectCreateModal").modal("show")},error:function(){}}):$.showError("未选择节点，不能创建子节点")});$("#SysObjectCreateModal").on("hide.bs.modal",function(){var n=$(this).find(".save-button").hasClass("save-clicked");n&&r()});$(".save-object").click(function(n){n.preventDefault();u()})})})();